<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="762px" preserveAspectRatio="none" style="width:861px;height:762px;background:#FFFFFF;" version="1.1" viewBox="0 0 861 762" width="861px" zoomAndPan="magnify"><defs><filter height="300%" id="f8cqkoartrv5s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="743.3418" style="stroke:#A80036;stroke-width:1.0;" width="230.5" x="421" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83" x="494.75" y="18.5684">Bob's device</text><rect fill="#FFFFFF" filter="url(#f8cqkoartrv5s)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="436" y="515.4785"/><rect fill="#FFFFFF" filter="url(#f8cqkoartrv5s)" height="132.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="621" y="314.6152"/><rect fill="#FFFFFF" filter="url(#f8cqkoartrv5s)" height="216.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="621" y="481.168"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="370" x2="370" y1="87.7988" y2="755.3418"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="441" x2="441" y1="87.7988" y2="755.3418"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="625.5" x2="625.5" y1="87.7988" y2="755.3418"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="797" x2="797" y1="87.7988" y2="755.3418"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="325" y="84.8457">Alice's clone</text><path d="M352,35.3105 C352,25.3105 370,25.3105 370,25.3105 C370,25.3105 388,25.3105 388,35.3105 L388,61.3105 C388,71.3105 370,71.3105 370,71.3105 C370,71.3105 352,71.3105 352,61.3105 L352,35.3105 " fill="#FEFECE" filter="url(#f8cqkoartrv5s)" style="stroke:#000000;stroke-width:1.5;"/><path d="M352,35.3105 C352,45.3105 370,45.3105 370,45.3105 C370,45.3105 388,45.3105 388,35.3105 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26" x="425" y="84.8457">app</text><ellipse cx="441" cy="55.3105" fill="#FEFECE" filter="url(#f8cqkoartrv5s)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="437,43.3105,443,38.3105,441,43.3105,443,48.3105,437,43.3105" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="604.5" y="84.8457">clone</text><path d="M608,35.3105 C608,25.3105 626,25.3105 626,25.3105 C626,25.3105 644,25.3105 644,35.3105 L644,61.3105 C644,71.3105 626,71.3105 626,71.3105 C626,71.3105 608,71.3105 608,61.3105 L608,35.3105 " fill="#FEFECE" filter="url(#f8cqkoartrv5s)" style="stroke:#000000;stroke-width:1.5;"/><path d="M608,35.3105 C608,45.3105 626,45.3105 626,45.3105 C626,45.3105 644,45.3105 644,35.3105 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f8cqkoartrv5s)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="88" x="751" y="52.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="758" y="72.8457">messaging</text><rect fill="#FFFFFF" filter="url(#f8cqkoartrv5s)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="436" y="515.4785"/><rect fill="#FFFFFF" filter="url(#f8cqkoartrv5s)" height="132.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="621" y="314.6152"/><rect fill="#FFFFFF" filter="url(#f8cqkoartrv5s)" height="216.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="621" y="481.168"/><polygon fill="#A80036" points="785,177.5518,795,181.5518,785,185.5518,789,181.5518" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="370" x2="791" y1="181.5518" y2="181.5518"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="377" y="176.8096">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="390" y="176.8096">Op3 ≪agree≫</text><rect fill="#FBFB77" filter="url(#f8cqkoartrv5s)" height="144" style="stroke:#A80036;stroke-width:1.0;" width="360" x="5" y="102.7988"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="8" x="9" y="118.8657">{</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="25" y="133.9985">"@delete": {</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="41" y="149.1313">"@id": "Bob",</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="41" y="164.2642">"mld:hasPermission": {</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="304" x="57" y="179.397">"mld:appliesToPattern": { "@id": "?" }</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="8" x="41" y="194.5298">}</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="8" x="25" y="209.6626">}</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="8" x="9" y="224.7954">}</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="256" x="9" y="239.9282">(deletes Bob's write permission)</text><path d="M738,256.9941 L738,281.9941 L852,281.9941 L852,266.9941 L842,256.9941 L738,256.9941 " fill="#FBFB77" filter="url(#f8cqkoartrv5s)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M842,256.9941 L842,266.9941 L852,266.9941 L842,256.9941 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="744" y="274.5625">Op3 is delayed</text><polygon fill="#A80036" points="609,310.6152,619,314.6152,609,318.6152,613,314.6152" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="441" x2="615" y1="314.6152" y2="314.6152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="448" y="309.873">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="461" y="309.873">Op4 ≪transaction≫</text><rect fill="#FBFB77" filter="url(#f8cqkoartrv5s)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="123" x="313" y="296.3047"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="317" y="312.5493">INSERT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="369" y="312.873"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="63" x="369" y="312.873">[anything]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="631" x2="673" y1="345.9258" y2="345.9258"/><line style="stroke:#A80036;stroke-width:1.0;" x1="673" x2="673" y1="345.9258" y2="358.9258"/><line style="stroke:#A80036;stroke-width:1.0;" x1="632" x2="673" y1="358.9258" y2="358.9258"/><polygon fill="#A80036" points="642,354.9258,632,358.9258,642,362.9258,638,358.9258" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="638" y="341.1836">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="651" y="341.1836">ACL constraint check</text><polygon fill="#A80036" points="785,384.2363,795,388.2363,785,392.2363,789,388.2363" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="631" x2="791" y1="388.2363" y2="388.2363"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="638" y="383.4941">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="651" y="383.4941">Op4</text><polygon fill="#A80036" points="452,413.5469,442,417.5469,452,421.5469,448,417.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="446" x2="620" y1="417.5469" y2="417.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="458" y="412.8047">5</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="471" y="412.8047">resolve</text><polygon fill="#A80036" points="452,442.8574,442,446.8574,452,450.8574,448,446.8574" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="446" x2="625" y1="446.8574" y2="446.8574"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="458" y="442.1152">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="471" y="442.1152">Op4 ≪update≫</text><polygon fill="#A80036" points="642,477.168,632,481.168,642,485.168,638,481.168" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="636" x2="796" y1="481.168" y2="481.168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="648" y="476.4258">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="661" y="476.4258">Op3</text><path d="M399,459.8574 L399,484.8574 L612,484.8574 L612,469.8574 L602,459.8574 L399,459.8574 " fill="#FBFB77" filter="url(#f8cqkoartrv5s)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M602,459.8574 L602,469.8574 L612,469.8574 L602,459.8574 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="405" y="477.4258">Op3 agreement pre-dates Op4</text><polygon fill="#A80036" points="457,511.4785,447,515.4785,457,519.4785,453,515.4785" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="451" x2="620" y1="515.4785" y2="515.4785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="463" y="510.7363">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="476" y="510.7363">Fork or Void?</text><polygon fill="#A80036" points="609,540.7891,619,544.7891,609,548.7891,613,544.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="441" x2="615" y1="544.7891" y2="544.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="448" y="540.0469">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="28" x="461" y="540.0469">Void</text><line style="stroke:#A80036;stroke-width:1.0;" x1="631" x2="673" y1="574.0996" y2="574.0996"/><line style="stroke:#A80036;stroke-width:1.0;" x1="673" x2="673" y1="574.0996" y2="587.0996"/><line style="stroke:#A80036;stroke-width:1.0;" x1="632" x2="673" y1="587.0996" y2="587.0996"/><polygon fill="#A80036" points="642,583.0996,632,587.0996,642,591.0996,638,587.0996" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="638" y="569.3574">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="660" y="569.3574">Void Op4</text><path d="M515,600.0996 L515,625.0996 L732,625.0996 L732,610.0996 L722,600.0996 L515,600.0996 " fill="#FBFB77" filter="url(#f8cqkoartrv5s)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M722,600.0996 L722,610.0996 L732,610.0996 L722,600.0996 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="521" y="617.668">Op4 also removed from Journal</text><line style="stroke:#A80036;stroke-width:1.0;" x1="631" x2="673" y1="655.7207" y2="655.7207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="673" x2="673" y1="655.7207" y2="668.7207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="632" x2="673" y1="668.7207" y2="668.7207"/><polygon fill="#A80036" points="642,664.7207,632,668.7207,642,672.7207,638,668.7207" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="638" y="650.9785">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="660" y="650.9785">Apply Op3</text><polygon fill="#A80036" points="452,694.0313,442,698.0313,452,702.0313,448,698.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="446" x2="625" y1="698.0313" y2="698.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="458" y="693.2891">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="480" y="693.2891">Op3 - Op4 ≪update≫</text><line style="stroke:#A80036;stroke-width:2.0;" x1="376" x2="386" y1="727.3418" y2="737.3418"/><line style="stroke:#A80036;stroke-width:2.0;" x1="376" x2="386" y1="737.3418" y2="727.3418"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="796" y1="732.3418" y2="732.3418"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="387" y="727.5996">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="409" y="727.5996">Op4</text><path d="M140,711.0313 L140,736.0313 L361,736.0313 L361,721.0313 L351,711.0313 L140,711.0313 " fill="#FBFB77" filter="url(#f8cqkoartrv5s)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M351,711.0313 L351,721.0313 L361,721.0313 L351,711.0313 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="146" y="728.5996">Ignore: op pre-dates agreement</text><!--MD5=[7ed42b57421ad89b37d297db4998ca08]
@startuml
'https://plantuml.com/sequence-diagram
hide footbox
autonumber

database "Alice's clone" as genesis
box Bob's device
control "app" as proc2
database "clone" as clone2
end box

genesis -> messaging: Op3 ≪agree≫
rnote left
<code>
{
  "@delete": {
    "@id": "Bob",
    "mld:hasPermission": {
      "mld:appliesToPattern": { "@id": "?" }
    }
  }
}
(deletes Bob's write permission)
end note

note over messaging
Op3 is delayed
end note

proc2 -> clone2 ++: Op4 ≪transaction≫
rnote left: ""INSERT"" //[anything]//

clone2 -> clone2: ACL constraint check

clone2 -> messaging: Op4
clone2 - -> proc2: //resolve//
clone2 -> proc2 - -: Op4 ≪update≫

messaging -> clone2 ++: Op3
note left: Op3 agreement pre-dates Op4
clone2 -> proc2 ++: Fork or Void?
proc2 - -> clone2 - -: Void
clone2 -> clone2: Void Op4
note over clone2: Op4 also removed from Journal
clone2 -> clone2: Apply Op3
clone2 -> proc2 - -: Op3 - Op4 ≪update≫

messaging -x genesis : Op4
note left: Ignore: op pre-dates agreement

@enduml

@startuml
hide footbox
autonumber

database "Alice's clone" as genesis
box Bob's device
control "app" as proc2
database "clone" as clone2
end box

genesis -> messaging: Op3 ≪agree≫
rnote left
<code>
{
  "@delete": {
    "@id": "Bob",
    "mld:hasPermission": {
      "mld:appliesToPattern": { "@id": "?" }
    }
  }
}
(deletes Bob's write permission)
end note

note over messaging
Op3 is delayed
end note

proc2 -> clone2 ++: Op4 ≪transaction≫
rnote left: ""INSERT"" //[anything]//

clone2 -> clone2: ACL constraint check

clone2 -> messaging: Op4
clone2 - -> proc2: //resolve//
clone2 -> proc2 - -: Op4 ≪update≫

messaging -> clone2 ++: Op3
note left: Op3 agreement pre-dates Op4
clone2 -> proc2 ++: Fork or Void?
proc2 - -> clone2 - -: Void
clone2 -> clone2: Void Op4
note over clone2: Op4 also removed from Journal
clone2 -> clone2: Apply Op3
clone2 -> proc2 - -: Op3 - Op4 ≪update≫

messaging -x genesis : Op4
note left: Ignore: op pre-dates agreement

@enduml

PlantUML version 1.2021.10(Mon Aug 30 14:43:48 BST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="632px" preserveAspectRatio="none" style="width:754px;height:632px;background:#FFFFFF;" version="1.1" viewBox="0 0 754 632" width="754px" zoomAndPan="magnify"><defs><filter height="300%" id="f12w31jgh49bg4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="613.4121" style="stroke:#A80036;stroke-width:1.0;" width="208.5" x="357" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83" x="419.75" y="18.5684">Bob's device</text><rect fill="#FFFFFF" filter="url(#f12w31jgh49bg4)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="385.5488"/><rect fill="#FFFFFF" filter="url(#f12w31jgh49bg4)" height="132.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="535" y="184.6855"/><rect fill="#FFFFFF" filter="url(#f12w31jgh49bg4)" height="216.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="535" y="351.2383"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="306" x2="306" y1="87.7988" y2="625.4121"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="377" x2="377" y1="87.7988" y2="625.4121"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="539.5" x2="539.5" y1="87.7988" y2="625.4121"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="698" x2="698" y1="87.7988" y2="625.4121"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="261" y="84.8457">Alice's clone</text><path d="M288,35.3105 C288,25.3105 306,25.3105 306,25.3105 C306,25.3105 324,25.3105 324,35.3105 L324,61.3105 C324,71.3105 306,71.3105 306,71.3105 C306,71.3105 288,71.3105 288,61.3105 L288,35.3105 " fill="#FEFECE" filter="url(#f12w31jgh49bg4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M288,35.3105 C288,45.3105 306,45.3105 306,45.3105 C306,45.3105 324,45.3105 324,35.3105 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26" x="361" y="84.8457">app</text><ellipse cx="377" cy="55.3105" fill="#FEFECE" filter="url(#f12w31jgh49bg4)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="373,43.3105,379,38.3105,377,43.3105,379,48.3105,373,43.3105" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="37" x="518.5" y="84.8457">clone</text><path d="M522,35.3105 C522,25.3105 540,25.3105 540,25.3105 C540,25.3105 558,25.3105 558,35.3105 L558,61.3105 C558,71.3105 540,71.3105 540,71.3105 C540,71.3105 522,71.3105 522,61.3105 L522,35.3105 " fill="#FEFECE" filter="url(#f12w31jgh49bg4)" style="stroke:#000000;stroke-width:1.5;"/><path d="M522,35.3105 C522,45.3105 540,45.3105 540,45.3105 C540,45.3105 558,45.3105 558,35.3105 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f12w31jgh49bg4)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="88" x="652" y="52.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="659" y="72.8457">messaging</text><rect fill="#FFFFFF" filter="url(#f12w31jgh49bg4)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="385.5488"/><rect fill="#FFFFFF" filter="url(#f12w31jgh49bg4)" height="132.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="535" y="184.6855"/><rect fill="#FFFFFF" filter="url(#f12w31jgh49bg4)" height="216.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="535" y="351.2383"/><polygon fill="#A80036" points="686,132.2422,696,136.2422,686,140.2422,690,136.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="306" x2="692" y1="136.2422" y2="136.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="313" y="131.5">Op3 ≪agree≫</text><rect fill="#FBFB77" filter="url(#f12w31jgh49bg4)" height="53" style="stroke:#A80036;stroke-width:1.0;" width="296" x="5" y="102.7988"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="9" y="118.8657">DELETE</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="272" x="25" y="133.9985">Bob mld:hasAccess { "@id": "?" } .</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="9" y="149.6328">(revokes Bob's write permission)</text><polygon fill="#A80036" points="523,180.6855,533,184.6855,523,188.6855,527,184.6855" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="377" x2="529" y1="184.6855" y2="184.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="384" y="179.9434">Op4 ≪transaction≫</text><rect fill="#FBFB77" filter="url(#f12w31jgh49bg4)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="123" x="249" y="166.375"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="253" y="182.6196">INSERT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="305" y="182.9434"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="63" x="305" y="182.9434">[anything]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="545" x2="587" y1="215.9961" y2="215.9961"/><line style="stroke:#A80036;stroke-width:1.0;" x1="587" x2="587" y1="215.9961" y2="228.9961"/><line style="stroke:#A80036;stroke-width:1.0;" x1="546" x2="587" y1="228.9961" y2="228.9961"/><polygon fill="#A80036" points="556,224.9961,546,228.9961,556,232.9961,552,228.9961" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="552" y="211.2539">ACL constraint check</text><polygon fill="#A80036" points="686,254.3066,696,258.3066,686,262.3066,690,258.3066" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="545" x2="692" y1="258.3066" y2="258.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="552" y="253.5645">Op4</text><polygon fill="#A80036" points="388,283.6172,378,287.6172,388,291.6172,384,287.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="382" x2="534" y1="287.6172" y2="287.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="45" x="394" y="282.875">resolve</text><polygon fill="#A80036" points="388,312.9277,378,316.9277,388,320.9277,384,316.9277" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="539" y1="316.9277" y2="316.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="394" y="312.1855">Op4 ≪update≫</text><polygon fill="#A80036" points="556,347.2383,546,351.2383,556,355.2383,552,351.2383" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="550" x2="697" y1="351.2383" y2="351.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="562" y="346.4961">Op3</text><path d="M313,329.9277 L313,354.9277 L526,354.9277 L526,339.9277 L516,329.9277 L313,329.9277 " fill="#FBFB77" filter="url(#f12w31jgh49bg4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M516,329.9277 L516,339.9277 L526,339.9277 L516,329.9277 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="319" y="347.4961">Op3 agreement pre-dates Op4</text><polygon fill="#A80036" points="393,381.5488,383,385.5488,393,389.5488,389,385.5488" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="387" x2="534" y1="385.5488" y2="385.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="399" y="380.8066">Fork or Revoke?</text><polygon fill="#A80036" points="523,410.8594,533,414.8594,523,418.8594,527,414.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="377" x2="529" y1="414.8594" y2="414.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="384" y="410.1172">Revoke</text><line style="stroke:#A80036;stroke-width:1.0;" x1="545" x2="587" y1="444.1699" y2="444.1699"/><line style="stroke:#A80036;stroke-width:1.0;" x1="587" x2="587" y1="444.1699" y2="457.1699"/><line style="stroke:#A80036;stroke-width:1.0;" x1="546" x2="587" y1="457.1699" y2="457.1699"/><polygon fill="#A80036" points="556,453.1699,546,457.1699,556,461.1699,552,457.1699" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="552" y="439.4277">Revoke Op4</text><path d="M429,470.1699 L429,495.1699 L646,495.1699 L646,480.1699 L636,470.1699 L429,470.1699 " fill="#FBFB77" filter="url(#f12w31jgh49bg4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M636,470.1699 L636,480.1699 L646,480.1699 L636,470.1699 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="435" y="487.7383">Op4 also removed from Journal</text><line style="stroke:#A80036;stroke-width:1.0;" x1="545" x2="587" y1="525.791" y2="525.791"/><line style="stroke:#A80036;stroke-width:1.0;" x1="587" x2="587" y1="525.791" y2="538.791"/><line style="stroke:#A80036;stroke-width:1.0;" x1="546" x2="587" y1="538.791" y2="538.791"/><polygon fill="#A80036" points="556,534.791,546,538.791,556,542.791,552,538.791" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="552" y="521.0488">Apply Op3</text><polygon fill="#A80036" points="388,564.1016,378,568.1016,388,572.1016,384,568.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="539" y1="568.1016" y2="568.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="394" y="563.3594">Op3 - Op4 ≪update≫</text><line style="stroke:#A80036;stroke-width:2.0;" x1="312" x2="322" y1="597.4121" y2="607.4121"/><line style="stroke:#A80036;stroke-width:2.0;" x1="312" x2="322" y1="607.4121" y2="597.4121"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="697" y1="602.4121" y2="602.4121"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="26" x="323" y="597.6699">Op4</text><path d="M76,581.1016 L76,606.1016 L297,606.1016 L297,591.1016 L287,581.1016 L76,581.1016 " fill="#FBFB77" filter="url(#f12w31jgh49bg4)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M287,581.1016 L287,591.1016 L297,591.1016 L287,581.1016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="82" y="598.6699">Ignore: op pre-dates agreement</text><!--MD5=[49c021510e775e8fe7dc208dff82f63f]
@startuml
'https://plantuml.com/sequence-diagram
hide footbox

database "Alice's clone" as genesis
box Bob's device
control "app" as proc2
database "clone" as clone2
end box

genesis -> messaging: Op3 ≪agree≫
rnote left
<code>
DELETE
  Bob mld:hasAccess { "@id": "?" } .
</code>
(revokes Bob's write permission)
end note

proc2 -> clone2 ++: Op4 ≪transaction≫
rnote left: ""INSERT"" //[anything]//

clone2 -> clone2: ACL constraint check

clone2 -> messaging: Op4
clone2 - -> proc2: //resolve//
clone2 -> proc2 - -: Op4 ≪update≫

messaging -> clone2 ++: Op3
note left: Op3 agreement pre-dates Op4
clone2 -> proc2 ++: Fork or Revoke?
proc2 - -> clone2 - -: Revoke
clone2 -> clone2: Revoke Op4
note over clone2: Op4 also removed from Journal
clone2 -> clone2: Apply Op3
clone2 -> proc2 - -: Op3 - Op4 ≪update≫

messaging -x genesis : Op4
note left: Ignore: op pre-dates agreement

@enduml

@startuml
hide footbox

database "Alice's clone" as genesis
box Bob's device
control "app" as proc2
database "clone" as clone2
end box

genesis -> messaging: Op3 ≪agree≫
rnote left
<code>
DELETE
  Bob mld:hasAccess { "@id": "?" } .
</code>
(revokes Bob's write permission)
end note

proc2 -> clone2 ++: Op4 ≪transaction≫
rnote left: ""INSERT"" //[anything]//

clone2 -> clone2: ACL constraint check

clone2 -> messaging: Op4
clone2 - -> proc2: //resolve//
clone2 -> proc2 - -: Op4 ≪update≫

messaging -> clone2 ++: Op3
note left: Op3 agreement pre-dates Op4
clone2 -> proc2 ++: Fork or Revoke?
proc2 - -> clone2 - -: Revoke
clone2 -> clone2: Revoke Op4
note over clone2: Op4 also removed from Journal
clone2 -> clone2: Apply Op3
clone2 -> proc2 - -: Op3 - Op4 ≪update≫

messaging -x genesis : Op4
note left: Ignore: op pre-dates agreement

@enduml

PlantUML version 1.2021.10(Mon Aug 30 14:43:48 BST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>